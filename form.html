<!doctype html>

<html>
  <head>
<!--     <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src='http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.1/ui-bootstrap-tpls.min.js'></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">  -->   

    <script src="lib/jquery.min.js"></script>
    <script src='lib/angular.js'></script>
    <script src='lib/ui-bootstrap-tpls.min.js'></script>
    <link rel="stylesheet" href="lib/bootstrap.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script>
      var app = angular.module("app", ['ui.bootstrap']);

      app.service("data", function() {
        var service = {};

        service.crops = ["Alfalfa",
          "Apple",
          "Barley",
          "Clover",
          "Coffee",
          "Cotton",
          "Dry Bean",
          "Grass-clover mix",
          "Maize",
          "Millet",
          "Oats",
          "Peanut",
          "Perennial grass",
          "Potato",
          "Rice",
          "Rye",
          "Sorghum",
          "Soyabean",
          "Spring wheat",
          "Tea",
          "Tomato",
          "Tree Crop",
          "Vegetable",
          "Winter wheat",
          "Other grain",
          "Other legume",
          "Other N-fixing forage",
          "Other Non-N-fixing forage",
          "Other root crops",
          "Other tuber crop",
          "Other"];

        service.area = ["hectares",
          "acres",
          "square metres"];        

        service.units = ["kilograms",
          "tonnes",
          "litres",
          "tons (US short)",
          "gallon (imperial)",
          "pounds",
          "gallons (US)",
          "units"];

        service.months = ["January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December"];        

        service.years = [2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010];

        service.period = ["start", "middle", "end"];

        return service;
      });

      app.controller('ctrl', function ($scope, $http, data) {

        $scope.data = data;

        $scope.crops = [{
          "type": "Alfalfa",
          "area": "12",
          "fresh": "100",
          "dry": "90",
          "area_unit": "acres",
          "fresh_unit": "pounds",
          "dry_unit": "pounds",
          "planting_period": "end",
          "planting_month": "April",
          "planting_year": 2017,
          "harvesting_period": "middle",
          "harvesting_month": "August",
          "harvesting_year": 2017
        }];

        $scope.addCrop = function() {
          $scope.crops.push({});
        }

        $scope.removeCrop = function(crop) {
          var index = $scope.crops.indexOf(crop);
          $scope.crops.splice(index, 1);
        };

        $scope.submit = function() {
          $http.post("http://localhost:8000", $scope.crops);
        };
        
      });
    </script>

    <style>
      label {
        display: inline-block; 
        width: 208px;
      }
    </style>

  </head>
  <body ng-app="app" ng-controller="ctrl" class="container">

    <form ng-submit="submit()">

      <div ng-repeat="crop in crops">

        <p>
          <label for="id_crop_type">Crop type</label>
          <select id="id_crop_type" name="crop_type" ng-model="crop.type" ng-options="crop for crop in data.crops"></select>
        </p>
        
        <p>
          <label for="id_field_size_value">Crop area</label>
          <input id="id_field_size_value" ng-model="crop.area"type="text">
          <select ng-model="crop.area_unit" ng-options="unit for unit in data.area"></select>
        </p>

        <p>
          <label for="id_product_fresh_value">Fresh product amount</label>
          <input id="id_product_fresh_value" ng-model="crop.fresh"type="text">
          <select ng-model="crop.fresh_unit" ng-options="unit for unit in data.units"></select>
        </p>

        <p>
          <label for="id_product_dry_value">Finished product amount</label>
          <input id="id_product_dry_value" ng-model="crop.dry" type="text">
          <select ng-model="crop.dry_unit" ng-options="unit for unit in data.units"></select>
        </p>

        <p>
          <label for="id_date_planting_time">Planting time</label>
          <select ng-model="crop.planting_period" ng-options="unit for unit in data.period" id="id_date_planting_time"></select>
          <select ng-model="crop.planting_month" ng-options="unit for unit in data.months"></select>
          <select ng-model="crop.planting_year" ng-options="unit for unit in data.years"></select>
        </p> 

        <p>
          <label for="id_date_harvesting_time">Harvesting date</label>
          <select ng-model="crop.harvesting_period" ng-options="unit for unit in data.period" id="id_date_harvesting_time"></select>
          <select ng-model="crop.harvesting_month" ng-options="unit for unit in data.months"></select>
          <select ng-model="crop.harvesting_year" ng-options="unit for unit in data.years"></select>
        </p>

        <a href ng-click="removeCrop(crop)" ng-show="$index !== 0">remove crop</a>

        <hr>

      </div>

      <p>
        <input type="button" value="Add crop" ng-click="addCrop()">
      </p>

      <p>
        <input type="submit" value="Submit">
      </p>

    </form>

    <pre>{{ crops | json }}</pre>

  </body>
</html>